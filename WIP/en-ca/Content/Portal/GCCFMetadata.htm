<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-ca" xml:lang="en-ca" class="_Skins_HTML5___Top_Navigation_Coronado" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developers corner|[%=System.LinkedTitle%]|Authentication and security">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>GCCF metadata</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/MainStyles.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/select-language.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.previous-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.remove-highlight-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/highlight.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/sanitize-html.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../A_Welcome pages/StartHere.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search our help and documentation" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div class="search-container">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="row collapse">
                                        <div class="top-bar">
                                            <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                <div class="button-group-container-left">
                                                    <button class="button needs-pie select-language-button" title="Change language">
                                                        <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="select language" />
                                                    </button>
                                                    <button class="button needs-pie print-button" title="Print">
                                                        <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                    </button>
                                                    <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                                        <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                                    </button>
                                                    <button class="button needs-pie next-topic-button" title="Navigate next">
                                                        <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                                    </button>
                                                    <button class="button needs-pie remove-highlight-button" title="Remove Highlights">
                                                        <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="remove highlight" />
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="nocontent">
                                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                                </div>
                                            </div> </div>
                                        <div class="topic-layout">
                                            <div>
                                                <div class="side-menu">
                                                    <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/Release_2_TOC.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                    </ul>
                                                </div>
                                                <div class="side-content">
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead dropDownHeadside-content"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Search Tips</a></span>
                                                        <div class="MCDropDownBody dropDownBody">
                                                            <p>Search is based on keyword.</p>
                                                            <p><samp>Ex:&#160;"Procedures"</samp>
                                                            </p>
                                                            <p>Do not search with natural language</p>
                                                            <p><samp>Ex:&#160;"How do I write a new procedure?"</samp>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div><a class="cta" href="https://technet.microsoft.com/en-us/library/mt812330.aspx"><div class="cta center"><p>Dynamics 365 Help
									</p></div></a>
                                            </div>
                                            <div>
                                                <h1><a name="aanchor267"></a>
                                                    <MadCap:concept term="Portal" />GCCF metadata</h1>
                                                <p><b>Metadata</b> is a term which occurs frequently when discussing the technical requirements of connecting to the GCCF environment. Both the portal, and the GCCF Providers (GCKey and SecureKey) create metadata files. While the requirements for GCCF metadata are formally laid out in the CATS2 specifically, it can be summarized as follows:</p>
                                                <ul>
                                                    <li value="1">Metadata provides all of the information which the portal and GCKey/SecureKey need to know about each other in order to exchange signed, encrypted SAML messages. This includes SAML endpoints URLs and certificates. It also describes a set of promises for how each side will process SAML messages. In short, metadata is a contract.<br /></li>
                                                    <li value="2">Metadata is provided in an XML file.<br /></li>
                                                    <li value="3">All GCCF metadata files contain a valid XML signature using the signing certificate of the issuer. The signature becomes embedded in the XML itself. For the portal, this means that the metadata XML must be signed by the private key of the portals’ ICM signing certificate.<br /></li>
                                                    <li value="4">Once signed, the contents of the metadata file cannot be changed in any way, or the signature will become invalid.<br /></li>
                                                    <li value="5">The metadata file contains the encryption and signing certificates for the entity who issued it. Only public keys are included in metadata—private keys are not included.<ul><li value="1">For GCKey and SecureKey, this is a copy of their encryption and signing ICM certificates.</li><li value="2">For the portal, this is a copy of the portal’s encryption and signing ICM certificates.</li></ul><p>Again, only public keys are included in a metadata file. Private keys are never provided to anyone.</p></li>
                                                </ul>
                                                <p>In order to generate a metadata file, the portal must have been issued a set of ICM signing and encryption certificates.</p>
                                                <p>The metadata file must choose a unique entity id.</p>
                                                <ul>
                                                    <li value="1">The entity id must be unique in the set of all GCCF portals. No two portals may share an entity id.</li>
                                                    <li value="2">The entity id looks like a URL, and typically contains the DNS name of the portal. However, the entity id is not an actual URL.</li>
                                                    <li value="3">The entity id is never seen by users.</li>
                                                    <li value="4">The entity id cannot be changed for the lifetime of the portal.</li>
                                                    <li value="5">For the portal, the entity id must match the entity id configured in ADFS.</li>
                                                    <li value="6">E.g. <code>https://&lt;portal ADFS DNS name&gt;/adfs/services/trust</code><br />(This entity id is based on the default style of entity id which would be generated by ADFS.)<br /></li>
                                                </ul>
                                                <p>The metadata file describes a set of SAML endpoints provided by the portal or by GCKey / SecureKey. It provides an Internet URL for each endpoint. SAML requests sent from the portal to GCKey / SecureKey and back will expect to send traffic to those endpoint URLs. In the case of the portal, some of the URLs map to ADFS. Others map to the custom ADFS extensions web application.<br /></p>
                                                <ul>
                                                    <li value="1">Metadata is only valid until the embedded certificates expire.<br /></li>
                                                    <li value="2">Because certificates expire, both the portal and GCKey / SecureKey must periodically obtain new ICM certificates and generate new metadata files. Activation of new metadata must be coordinated on both sides, or the Portal will be unable to communicate with GCKey / SecureKey. </li>
                                                    <li value="3">For production, activation of new metadata is coordinated using a conference call. For development, activation of new metadata is simply scheduled for a pre-determined date and time.</li>
                                                </ul>
                                                <h2>Metadata refresh – portal metadata</h2>
                                                <p>When the portal’s GCCF certificates are expiring, it is necessary to obtain new GCCF certificates, generate a new metadata file, communicate the new metadata to GCKey and SecureKey, and activate the new metadata at the same time that GCKey and SecureKey do.</p>
                                                <h4>Phase 1 – Retrieve and process new GCCF certificates, generate metadata.</h4>
                                                <p>For more information about retrieving and processing certificates, <a href="Cert-GCCF.htm" class="MCXref xref">GCCF certificates</a></p>
                                                <ol>
                                                    <li value="1">An LRA (local registration authority) for the portal requests new GCCF certificates from ICM.<br /></li>
                                                    <li value="2">ICM generate the new certificates. The LRA is provided with request and authorization codes. The LRA retrieve the GCCF certificates using the Entrust desktop client.<br /></li>
                                                    <li value="3">GCCF certificates are exported from Entrust in <code>.pfx</code> format. There should be two files: an encryption certificate and a signing certificate. Both certificates must have private keys. Each files should only contain a single certificate.<br /></li>
                                                    <li value="4">Encryption and signing certificates are processed via OpenSSL and saved as a pair of <code>.p12</code> files.</li>
                                                    <li value="5">Ensure that the <code>GC.GCCF</code> configuration file <code>&lt;portal&gt;.config.xml</code> file is updated with the subject name of the new GCCF certificates. Subject names for GCCF certificates always start with GCCF. Ensure that a build of the <code>GC.GCCF</code> project is available which has this updated configuration.<br /><p><code>CertificateSubjectIcm = "GCCF&lt;portal subject name&gt;"</code><br /></p></li>
                                                    <li value="6">Generate a metadata file for the portal (for more detail see below, “Creating Portal Metadata”).<br /><code>_Build\Scripts\Update-AdfsMetadata.ps1 -SigningCertificateFile .\&lt;certificate name&gt;.sig.p12 -EncryptionCertificateFile .\&lt;certificate name&gt;.enc.p12 -InputMetadataFile ".\&lt;old Portal metadata&gt;.xml" -OutputMetadataFile .\&lt;portal ADFS DNS name&gt;.&lt;date&gt;.xml</code><br /></li>
                                                    <li value="7">The metadata file is sent to the SSC ECM group for validation and distribution the GCKey/SecureKey.</li>
                                                    <li value="8">A maintenance window is booked with the ECM group to perform the metadata update. ECM will schedule a conference all with the portal, GCKey, and SecureKey at the same time.</li>
                                                </ol>
                                                <h4>Phase 2 – Update ADFS, ADFS extensions, and SharePoint with new GCCF certificates</h4>
                                                <ol>
                                                    <li value="1">It is assumed that the ICM root certificate was loaded into the certificate store of the ADFS server during initial installation of the Portal. This step should not be required again, but is included for completeness.<br /><code>.\_Build\Scripts\Import-IcmRootCertificateSharePoint.ps1</code><br /></li>
                                                    <li value="2">The .p12 GCCF certificates are loaded into the Windows certificate store on the ADFS server (machine store, personal folder). <u>Private keys must be included with the certificates</u>. No changes are made to ADFS. This may be done with PowerShell <code>Import-PfxCertificate</code> or <code>certutil.exe</code>.<br /><code>certutil.exe -importpfx &lt;certificate name&gt;.sig.p12</code><br /><code>certutil.exe -importpfx &lt;certificate name&gt;.eng.p12</code></li>
                                                    <li value="3">Private keys for the encryption and signing certificates are updated to grant read permissions to the ADFS service account.<br /><code>.\_Build\Scripts\Configure-AdfsCertificatePermissions.ps1</code></li>
                                                    <li value="4">The GCCF signing certificate is exported, <u>without private key</u>, to a <code>.cer</code> file. This file should be copied to a SharePoint server.<br /><code>.\_Build\Scripts\Export-GccfSigningCertificate.ps1 -SigningCertificateFile .\&lt;certificate name&gt;.sig.cer</code><br /></li>
                                                    <li value="5">During the scheduled conference call with GCKey and SecureKey, the new metadata is activated:<br /><ul><li value="1">GCKey / SecureKey activate the metadata on their ends.</li><li value="2">The new Portal GCCF&#160;certificates are activated as the primary signing and encrypting certificates in ADFS.<br /><code>.\_Build\Scripts\Update-AdfsGCCFCertificates.ps1</code><br /></li><li value="3">Configuration for ADFS Extensions is updated with the thumbprint of the new GCCF signing certificate.<br />(edit file) <code>C:\inetpub\wwwroot_gccf_adfs\AdfsExtensions\App_Data\sp-extended.xml</code><br /></li><li value="4">Recycle the application pool of the ADFS Extension web app:<br /><code>C:\Windows\System32\inetsrv\appcmd.exe recycle apppool GccfAdfsExtensions</code></li><li value="5">The SharePoint trusted token issuer is updated with the new GCCF signing certificate.<br /><code>$cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2 "$(get-location)\&lt;certificate name&gt;sig.cer"</code><br /><code>Set-SPTrustedIdentityTokenIssuer -Identity "gccf-adfs" -ImportTrustCertificate $sigNewCert</code></li></ul></li>
                                                </ol>
                                                <h2>Metadata refresh – GCKey or SecureKey</h2>
                                                <p>When GCCF certificates are expiring for GCKey or SecureKey, they must obtain new GCCF certificates and provide a new metadata file to the Portal. This metadata file must be loaded into ADFS and the ADFS Extensions web application during a pre-scheduled conference call.</p>
                                                <ol>
                                                    <li value="1">GCKey / SecureKey orders new certificates, generates new metadata file, provides metadata to ECM group for verification and distribution to the Portal.<br /></li>
                                                    <li value="2">ECM schedules a maintenance window and conference call with the portal and GCKey or SecureKey.<br /></li>
                                                    <li value="3">During the conference call:<br /><ul><li value="1">The new provider metadata is loaded into ADFS. This command will report a warning message about unsupported SAML bindings, which is expected, can be ignored. <b>“WARNING: PS0031: Some portions of the metadata document were ignored. MSIS7524: A 'SamlSingleLogoutService' endpoint was ignored because its binding 'urn:oasis:names:tc:SAML:2.0:bindings:SOAP' is not supported."</b><br /><code>Update-ADFSClaimsProviderTrust -TargetName "SecureKey" -MetadataFile "$(get-location)\&lt;SecureKey metadata file&gt;.xml"</code><p>or</p><p><code>Update-ADFSClaimsProviderTrust -TargetName "GCKey" -MetadataFile "$(get-location)\&lt;GCKey metadata file&gt;.xml"</code></p></li><li value="2">The provider’s metadata file is loaded into the ADFS Extensions web application. Note that SecureKey is IDP1 and GCKey is IDP2 in the web application.<br /><code>copy "$(get-location)\&lt;SecureKey metadata file&gt;.xml" C:\inetpub\wwwroot_gccf_adfs\AdfsExtensions\App_Data\idp1.xml</code><p>or<br /><code>copy "$(get-location)\&lt;GCKey metadata file&gt;.xml" C:\inetpub\wwwroot_gccf_adfs\AdfsExtensions\App_Data\idp2.xml</code></p></li></ul></li>
                                                </ol>
                                                <h2>Creating a portal metadata file</h2>
                                                <p>The recommended way to create a metadata package for the portal is an included custom PowerShell script. This PowerShell script will read an existing metadata package which is treated as a template. The template is updated to match the technical details of the portal. Once the metadata package has been updated, it will be signed using the portal’s signing certificate, and written into a new file.</p>
                                                <p>If no previous portal metadata package has been created, a template metadata file has been supplied in the <code>_Build</code> output from the <code>GC.GCCF</code> solution.</p>
                                                <p>A metadata file cannot be created until GCCF ICM certificates have been obtained, and processed by OpenSSL.</p>
                                                <h4>First metadata file</h4>
                                                <p>When creating a metadata file for a new portal, it is necessary to specify the ADFS DNS name. This is the DNS name which will be used from the Internet to direct traffic to the ADFS server. It may be the same as the SharePoint DNS name, or different.</p>
                                                <p>As an example, the ACOA production Portal uses the following:</p>
                                                <ul>
                                                    <li value="1"><a href="https://direct.acoa-apeca.gc.ca"><span class="Hyperlink">https://direct.acoa-apeca.gc.ca</span></a> for SharePoint</li>
                                                    <li value="2"><a href="https://direct.acoa-apeca.gc.ca"><span class="Hyperlink">https://direct.acoa-apeca.gc.ca</span></a> for ADFS</li>
                                                </ul>
                                                <p>WD’s production portal uses:</p>
                                                <ul>
                                                    <li value="1"><a href="https://www2.wd-deo.gc.ca"><span class="Hyperlink">https://www2.wd-deo.gc.ca</span></a> for SharePoint</li>
                                                    <li value="2"><a href="https://akwww2.wd-deo.gc.ca"><span class="Hyperlink">https://akwww2.wd-deo.gc.ca</span></a> for ADFS</li>
                                                </ul>
                                                <p>There is no technical requirement that the DNS name must be the same for ADFS and SharePoint. It is a more flexible configuration to choose a different DNS name for SharePoint and ADFS, and recommended for new portals.</p>
                                                <p>To generate the first metadata file for the portal using the supplied template:</p>
                                                <p><code>_Build\Scripts\Update-AdfsMetadata.ps1 -SigningCertificateFile .\&lt;certificate name&gt;.sig.p12 -EncryptionCertificateFile .\&lt;certificate name&gt;.enc.p12 -InputMetadataFile ".\_Build\Config\EGCS-SESC\ADFS Metadata\adfs_metadata_template.xml" -OutputMetadataFile ".\&lt;portal ADFS DNS name&gt;.&lt;date&gt;.xml" -AdfsDnsName &lt;portal ADFS DNS name&gt;</code>
                                                </p>
                                                <p>This command:</p>
                                                <ul>
                                                    <li value="1">Prompts for the password to the signing and encryption certificates</li>
                                                    <li value="2">Reads<code> adfs_metadata_template.xml</code></li>
                                                    <li value="3">Changes the metadata entity id string to <code>https://&lt;portal ADFS DNS name&gt;/adfs/services/trust</code></li>
                                                    <li value="4">Updates SAML endpoint URLs in the metadata to use <code>https://&lt;portal ADFS DNS name&gt;</code></li>
                                                    <li value="5">Exports and embeds the GCCF encryption and signing certificates into the metadata.<br />Private keys are not exported.</li>
                                                    <li value="6">Signs the metadata package with the GCCF signing certificate.</li>
                                                    <li value="7">Exports the metadata package into an XML file <code>&lt;portal ADFS DNS name&gt;.&lt;date&gt;.xml</code></li>
                                                </ul>
                                                <h4>Portal metadata file update</h4>
                                                <p>When it is time to refresh the portal metadata, a similar command is used. In this case the old portal metadata is read and updated with new certificates. No changes are made to the metadata entity id or the SAML endpoint URLs.</p>
                                                <p><code>_Build\Scripts\Update-AdfsMetadata.ps1 -SigningCertificateFile .\&lt;certificate name&gt;.sig.p12 -EncryptionCertificateFile .\&lt;certificate name&gt;.enc.p12 -InputMetadataFile ".\_Build\Config\EGCS-SESC\ADFS Metadata\adfs_metadata_template.xml" -OutputMetadataFile ".\&lt;portal ADFS DNS name&gt;.&lt;date&gt;.xml"</code>
                                                </p>
                                                <p>This command:</p>
                                                <ul>
                                                    <li value="1">Prompts for the password to the signing and encryption certificates</li>
                                                    <li value="2">Reads<code> &lt;old Portal metadata&gt;.xml</code></li>
                                                    <li value="3">Exports and embeds the GCCF encryption and signing certificates into the metadata.<br />Private keys are not exported.</li>
                                                    <li value="4">Signs the metadata package with the GCCF signing certificate.</li>
                                                    <li value="5">Exports the metadata package into an XML file <code>&lt;portal ADFS DNS name&gt;.&lt;date&gt;.xml</code></li>
                                                </ul>
                                                <p><a class="MCHelpControl MCHelpControl-Concept conceptLink" data-mc-concepts="Portal" href="javascript:void(0);" data-mc-topics="About GCCF|GCCFAbout.htm#aanchor166||About the portal|AboutPortal.htm#aanchor395||About the portal|AboutPortal.htm#aanchor396||ADFS extensions web application|ADFSExtensionswebApp.htm#aanchor217||Alphinat SmartGuide documentation|SmartGuide/AlphinatDoc.htm#aanchor44||Authentication for GCCF users|GCCFAuthentication.htm#aanchor22||Authentication for RDA users|AuthenticationRDA.htm#aanchor214||Build and deploy SPFx apps|SPFxAppsBuildDeploy.htm#aanchor140||Configure forms for the portal|SmartGuide/ConfigureApplic on portal.htm#aanchor442||Create new forms|SmartGuide/CreateNewForms.htm#aanchor242||Data transfer from the portal to GCPM|DataTransfer.htm#aanchor256||Deploying forms for the portal with SmartGuide|SmartGuide/PortalFormDeploy.htm#aanchor0||Developing forms for the portal with SmartGuide|SmartGuide/PortalFormDev.htm#aanchor203||Developing portal forms - connections|SmartGuide/PortalFormDevConnections.htm#aanchor106||Developing SPFx Web Parts|SPFxAppsProjectFolders.htm#aanchor145||Documents on the portal |PortalDocs.htm#aanchor422||Dynamic portal forms|SmartGuide/PortalFormDynamic.htm#aanchor394||EGCS.Portal configuration|EGCSPortalConfig.htm#aanchor368||EGCS.Portal Visual Studio Solution|VSSolutionEGCSPortal.htm#aanchor321||FormManager web service overview|WebServicePortalFormMgr.htm#aanchor10||FormManager web service|WebServiceFormMgr.htm#aanchor127||GC.GCCF configuration|GCCFConfig.htm#aanchor388||GC.GCCF Visual Studio Solution|VSSolutionGCCF.htm#aanchor428||GCCF certificates|Cert-GCCF.htm#aanchor18||GCCF common domain web application|GCCFCommonDomainWebApp.htm#aanchor320||GCCF database|GCCFDatabase.htm#aanchor205||GCCF metadata|#aanchor267||GCPM authentication|GCPMAuthentication.htm#aanchor8||GCPM&#160;Smartlet Structure |SmartGuide/PortalFormSmartletStructure.htm#aanchor213||Invite a GC&#160;Client to the portal|UsingPortal/InviteClient.htm#aanchor191||Navigate the portal|UsingPortal/NavigatePortal.htm#aanchor144||Portal - master page overview|PortalMasterPage.htm#aanchor25||Portal branding|PortalBranding.htm#aanchor261||Portal configuration - invitation email|PortalConfigInviteEmail.htm#aanchor227||Portal document integration with GCPM&#160;|PortalDocIntegGCPM.htm#aanchor231||Portal entity relationship diagram|../Modules/ERDs/ERD Portal.htm#aanchor131||Portal integration with GCPM|Portal-GCPMIntegration.htm#aanchor2||Portal release notes 1.0|PortalReleaseNotes1.0.htm#aanchor38||Portal security|PortalSecurity.htm#aanchor263||RDA web service and portal web service certificates|Cert-RDAWebService.htm#aanchor215||RDA web service|WebServiceRDA.htm#aanchor123||Reverse proxy server for the portal|PortalReverseProxy.htm#aanchor212||SharePoint - portal site structure|PortalSharepointSiteStructure.htm#aanchor156||SharePoint web service|WebserviceSharePoint.htm#aanchor313||SPFx apps for the portal|SPFxAppsPortal.htm#aanchor208||SSL certificate|Cert-SSL.htm#aanchor310||Submit forms on the portal|UsingPortal/SubmitForms.htm#aanchor357||Submit tabular data with a form|UsingPortal/SubmitFormTable.htm#aanchor162||Web services for portal integration|WebServicesPortal.htm#aanchor238||WebAPI&#160;web service|WebServiceWebAPI.htm#aanchor362||Windows service - document management|WindowsDocMgt.htm#aanchor184||Windows service - site creation|WindowsSiteCreation.htm#aanchor255"><span class="MCHelpControl-ConceptHotSpot_"><img class="MCHelpControl_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="16" width="16" alt="Concept Link Icon" />See Also</span></a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>